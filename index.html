<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Cashback-Rechner</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #E9EAEC;
            color: #0f172a;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container { max-width: 680px; width: 100%; }
        .card {
            background: #ffffff;
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(15,23,42,0.08);
            padding: 26px;
            margin-bottom: 18px;
        }
        .top-row { display:flex; justify-content:space-between; align-items:center; gap:12px; }
        h1 { color:#0f172a; font-size:26px; display:flex; align-items:center; gap:10px; }
        .form-group { margin-bottom:16px; }
        label { display:block; margin-bottom:8px; color:#334155; font-weight:600; font-size:14px; }
        .input-row { display:flex; gap:10px; align-items:flex-end; }
        input[type="number"], input[type="text"], select {
            width:100%; padding:10px 12px; border:1px solid #d0d5db; border-radius:8px; font-size:15px;
            background:#fbfdfe; color:#0f172a; transition:border-color .18s, box-shadow .18s;
        }
        input:focus, select:focus { outline:none; border-color:#2b6cb0; box-shadow:0 0 0 4px rgba(43,108,176,0.08); }
        select.small { width:130px; flex-shrink:0; }
        .results-card { background:#ffffff; color:#0f172a; border:1px solid #e6eaed; box-shadow:0 6px 18px rgba(15,23,42,.06); }
        .results-card h2 { color:#0f172a; margin-bottom:12px; font-size:20px; display:flex; align-items:center; gap:10px; }
        .result-item { display:flex; justify-content:space-between; align-items:center; padding:12px 0; border-bottom:1px solid rgba(15,23,42,.06); }
        .result-item:last-child { border-bottom:none; }
        .result-label { font-size:14px; color:#334155; }
        .result-value { font-size:18px; font-weight:700; color:#0f172a; }
        .result-value.highlight { font-size:20px; color:#FF3400; }
        .currency-symbol { margin-left:6px; color:#475569; }
        .info-wrapper { margin:18px 0; display:grid, gap:12px; }
        .info-box { background:#ffffff; border-radius:12px; padding:16px; box-shadow:0 6px 18px rgba(15,23,42,.05); font-size:14px; color:#0f172a; line-height:1.45; border:1px solid #e6eaed; }
        .info-box h3 { margin-bottom:8px; font-size:15px; color:#0f172a; }
        .info-box ul { margin-left:18px; margin-top:6px; color:#334155; }
        .info-box .example { margin-top:10px; padding:10px; background:#fff6f1; border-left:4px solid #FF3400; border-radius:8px; font-weight:600; white-space:pre-line; color:#0f172a; }
        .info-box.secondary { background:#fffefa; }
        .small-inline { width:120px; display:inline-block; vertical-align:middle; }
        @media (max-width:600px) {
            .card { padding:18px; } h1 { font-size:20px; } .input-row { flex-direction:column; align-items:stretch; } select.small { width:100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="top-row">
                <h1 id="appHeader">Cashback-Rechner</h1>
                <div style="display:flex; gap:8px; align-items:center;">
                    <label for="langSelect" style="font-weight:600; color:#334155; font-size:14px; margin-right:6px;">DE</label>
                    <select id="langSelect" class="small" aria-label="Language">
                        <option value="de">Deutsch</option>
                        <option value="en">English</option>
                        <option value="es">Español</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label id="labelPurchase" for="purchaseAmount">Kaufbetrag (inkl. MwSt.):</label>
                <div class="input-row">
                    <input type="number" id="purchaseAmount" min="0" step="0.01" placeholder="100.00" value="100" />
                    <select id="currency" class="small" aria-label="Currency">
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="SEK">SEK</option>
                        <option value="PLN">PLN</option>
                        <option value="MXN">MXN</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label id="labelVat" for="vatRate">Mehrwertsteuersatz (%):</label>
                <input type="number" id="vatRate" min="0" max="100" step="0.1" placeholder="19" value="19" />
            </div>

            <div class="form-group">
                <label id="labelCashbackRate" for="cashbackRate">Cashback-Rate (%):</label>
                <input type="number" id="cashbackRate" min="0" max="100" step="0.1" placeholder="2.5" value="2.5" />
            </div>

            <div class="form-group">
                <label style="display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="usdBgToggle" />
                    <span id="usdBgToggleLabel">USD-Konversion im Hintergrund</span>
                </label>
            </div>

            <div class="form-group">
                <label style="display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="capToggle" />
                    <span id="capToggleLabel">Cashback-Limit aktivieren</span>
                </label>
                <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
                    <input type="number" id="capAmount" class="small-inline" step="0.01" min="0" placeholder="40.00" disabled />
                    <span id="capCurrencyLabel">€</span>
                </div>
            </div>
        </div>

        <div class="card results-card">
            <h2 id="resultsHeader">Ergebnis</h2>

            <div class="result-item">
                <span class="result-label" id="labelNet">Preis exkl. MwSt.:</span>
                <span class="result-value" id="resultNetPrice">0.00</span>
            </div>

            <div class="result-item">
                <span class="result-label" id="labelCashback">Cashback:</span>
                <span class="result-value highlight" id="resultCashback">0.00</span>
            </div>

            <div class="result-item">
                <span class="result-label" id="labelEffective">Effektivpreis:</span>
                <span class="result-value highlight" id="resultEffectivePrice">0.00</span>
            </div>

            <div class="result-item" id="conversionRow" style="display:none;">
                <span class="result-label" id="labelEffectiveAfter">Effektivpreis (nach USD-Konversion):</span>
                <span class="result-value" id="resultEffectiveAfter">0.00</span>
            </div>
        </div>

        <!-- Infoboxen: Erläuterungen (unter den Ergebnissen) -->
        <div class="info-wrapper" aria-label="Erläuterungen">
            <div class="info-box" role="note">
                <h3 id="howHeader">Wie funktioniert Cashback?</h3>
                <p id="howText">Cashback ist eine Rückvergütung, die du für Online-Einkäufe erhältst und die dir aufs Bankkonto ausgezahlt wird.</p>
                <p>&nbsp;</p>
                <p><strong id="importantHeader">Wichtig zu wissen:</strong></p>
                <ul id="importantList">
                    <li>Cashback wird immer auf den Netto-Preis berechnet (Kaufpreis ohne Mehrwertsteuer)</li>
                    <li>Die Cashback-Rate variiert je nach Shop (meist 1–10%)</li>
                </ul>
                <div class="example" id="howExample">Beispiel:

Kaufpreis: 100€ (inkl. 19% MwSt.)
Netto-Preis: 84.03€
Cashback (3%): 2.52€

→ Du zahlst effektiv nur 97.48€</div>
            </div>
        </div>
    </div>

    <script>
        const LANG_MAP = {
            de: {
                usdBgToggle: 'USD-Konversion im Hintergrund',
                capToggle: 'Cashback-Limit aktivieren',
                capPlaceholder: '40.00',
                capCurrency: '€',
                labelEffectiveAfter: 'Effektivpreis (nach USD-Konversion):',
                langLabel: 'Deutsch',
                title: 'Cashback-Rechner',
                header: 'Cashback-Rechner',
                labelPurchase: 'Kaufbetrag (inkl. MwSt.):',
                labelVat: 'Mehrwertsteuersatz (%):',
                labelCashbackRate: 'Cashback-Rate (%):',
                resultsHeader: 'Ergebnis',
                labelNet: 'Preis exkl. MwSt.:',
                labelCashback: 'Cashback:',
                labelEffective: 'Effektivpreis:',
                labelSavings: 'Ersparnis:',
                howHeader: 'Wie funktioniert Cashback?',
                howText: 'Cashback ist eine Rückvergütung, die du für Online-Einkäufe erhältst und die dir aufs Bankkonto ausgezahlt wird.',
                importantHeader: 'Wichtig zu wissen:',
                importantList: [
                    'Cashback wird immer auf den Netto-Preis berechnet (Kaufpreis ohne Mehrwertsteuer)',
                    'Die Cashback-Rate variiert je nach Shop (meist 1–10%)'
                ],
                howExample: 'Beispiel:\n\nKaufpreis: 100€ (inkl. 19% MwSt.)\nNetto-Preis: 84.03€\nCashback (3%): 2.52€\n\n→ Du zahlst effektiv nur 97.48€'
            },
            en: {
                usdBgToggle: 'USD conversion in background',
                capToggle: 'Enable cashback cap',
                capPlaceholder: '40.00',
                capCurrency: '€',
                labelEffectiveAfter: 'Effective price (after USD conversion):',
                langLabel: 'English',
                title: 'Cashback Calculator',
                header: 'Cashback Calculator',
                labelPurchase: 'Purchase amount (incl. VAT):',
                labelVat: 'VAT rate (%):',
                labelCashbackRate: 'Cashback rate (%):',
                resultsHeader: 'RESULTS',
                labelNet: 'Price excl. VAT:',
                labelCashback: 'Cashback:',
                labelEffective: 'Effective price:',
                labelSavings: 'Savings:',
                howHeader: 'How cashback works',
                howText: 'Cashback is a partial refund you receive on online purchases; the amount is returned to your bank account.',
                importantHeader: 'Important to know:',
                importantList: [
                    'Cashback is always calculated on the net price (price before VAT)',
                    'Cashback rates vary by shop (typically 1–10%)'
                ],
                howExample: 'Example:\n\nPurchase: €100 (incl. 19% VAT)\nNet price: €84.03\nCashback (3%): €2.52\n\n→ You effectively pay €97.48'
            },
            es: {
                usdBgToggle: 'Conversión a USD en segundo plano',
                capToggle: 'Activar límite de cashback',
                capPlaceholder: '40.00',
                capCurrency: '€',
                labelEffectiveAfter: 'Precio efectivo (tras conversión a USD):',
                langLabel: 'Español',
                title: 'Calculadora de Cashback',
                header: 'Calculadora de Cashback',
                labelPurchase: 'Importe de compra (incl. IVA):',
                labelVat: 'Tipo de IVA (%):',
                labelCashbackRate: 'Tasa de cashback (%):',
                resultsHeader: 'RESULTADOS',
                labelNet: 'Precio sin IVA:',
                labelCashback: 'Cashback:',
                labelEffective: 'Precio efectivo:',
                labelSavings: 'Ahorro:',
                howHeader: 'Cómo funciona el cashback',
                howText: 'El cashback es un reembolso parcial por compras online que se abona en tu cuenta bancaria.',
                importantHeader: 'Importante saber:',
                importantList: [
                    'El cashback siempre se calcula sobre el precio neto (sin IVA)',
                    'La tasa de cashback varía según la tienda (normalmente 1–10%)'
                ],
                howExample: 'Ejemplo:\n\nCompra: 100 € (incl. 19% IVA)\nPrecio neto: 84,03 €\nCashback (3%): 2,52 €\n\n→ Pagas efectivamente 97,48 €'
            }
        };

        // DOM refs
        const langSelect = document.getElementById('langSelect');
        const appHeader = document.getElementById('appHeader');
        const labelPurchase = document.getElementById('labelPurchase');
        const labelVat = document.getElementById('labelVat');
        const labelCashbackRate = document.getElementById('labelCashbackRate');
        const resultsHeader = document.getElementById('resultsHeader');
        const labelNet = document.getElementById('labelNet');
        const labelCashback = document.getElementById('labelCashback');
        const labelEffective = document.getElementById('labelEffective');
        const howHeader = document.getElementById('howHeader');
        const howText = document.getElementById('howText');
        const importantHeader = document.getElementById('importantHeader');
        const importantList = document.getElementById('importantList');
        const howExample = document.getElementById('howExample');

        const usdBgToggle = document.getElementById('usdBgToggle');
        const usdBgToggleLabel = document.getElementById('usdBgToggleLabel');
        const conversionRow = document.getElementById('conversionRow');
        const labelEffectiveAfter = document.getElementById('labelEffectiveAfter');
        const resultEffectiveAfter = document.getElementById('resultEffectiveAfter');

        const capToggle = document.getElementById('capToggle');
        const capToggleLabel = document.getElementById('capToggleLabel');
        const capAmount = document.getElementById('capAmount');
        const capCurrencyLabel = document.getElementById('capCurrencyLabel');
        
        // other DOM
        const purchaseAmountInput = document.getElementById('purchaseAmount');
        const currencySelect = document.getElementById('currency');
        const vatRateInput = document.getElementById('vatRate');
        const cashbackRateInput = document.getElementById('cashbackRate');
        const resultNetPrice = document.getElementById('resultNetPrice');
        const resultCashback = document.getElementById('resultCashback');
        const resultEffectivePrice = document.getElementById('resultEffectivePrice');

        // i18n apply
        function applyTranslations(lang) {
            const t = LANG_MAP[lang] || LANG_MAP.de;
            document.documentElement.lang = lang;
            document.title = t.title;
            appHeader.textContent = t.header;
            labelPurchase.textContent = t.labelPurchase;
            labelVat.textContent = t.labelVat;
            labelCashbackRate.textContent = t.labelCashbackRate;
            resultsHeader.textContent = t.resultsHeader;
            labelNet.textContent = t.labelNet;
            labelCashback.textContent = t.labelCashback;
            labelEffective.textContent = t.labelEffective;
            howHeader.textContent = t.howHeader;
            howText.textContent = t.howText;
            importantHeader.textContent = t.importantHeader;
            if (usdBgToggleLabel) usdBgToggleLabel.textContent = t.usdBgToggle;
            if (capToggleLabel) capToggleLabel.textContent = t.capToggle;
            if (capAmount) capAmount.placeholder = t.capPlaceholder || '';
            if (capCurrencyLabel) capCurrencyLabel.textContent = t.capCurrency || '€';
            if (labelEffectiveAfter) labelEffectiveAfter.textContent = t.labelEffectiveAfter;

            importantList.innerHTML = '';
            t.importantList.forEach(item => {
                const li = document.createElement('li'); li.textContent = item; importantList.appendChild(li);
            });

            howExample.textContent = t.howExample;
        }

        // initialize language
        langSelect.addEventListener('change', () => {
            applyTranslations(langSelect.value);
        });

        // currency symbols kept for formatting
        const CURRENCY_SYMBOLS = { EUR: '€', GBP: '£', SEK: 'kr', PLN: 'zł', MXN: '$' };

        document.addEventListener('DOMContentLoaded', () => {
            applyTranslations(langSelect.value || 'de');
            updateCapCurrencyLabel();
            calculateCashback();
            setupEventListeners();
        });

        function setupEventListeners() {
            purchaseAmountInput.addEventListener('input', calculateCashback);
            vatRateInput.addEventListener('input', calculateCashback);
            cashbackRateInput.addEventListener('input', calculateCashback);
            currencySelect.addEventListener('change', () => { updateCapCurrencyLabel(); calculateCashback(); });
            if (usdBgToggle) usdBgToggle.addEventListener('change', calculateCashback);
            if (capToggle) {
                capToggle.addEventListener('change', () => {
                    capAmount.disabled = !capToggle.checked;
                    calculateCashback();
                });
            }
            if (capAmount) capAmount.addEventListener('input', calculateCashback);
        }

        function updateCapCurrencyLabel() {
            const cur = currencySelect.value;
            capCurrencyLabel.textContent = CURRENCY_SYMBOLS[cur] || cur;
        }

        function calculateCashback() {
            const purchaseAmount = parseFloat(purchaseAmountInput.value) || 0;
            const vatRate = parseFloat(vatRateInput.value) || 0;
            const cashbackRate = parseFloat(cashbackRateInput.value) || 0;
            const currency = currencySelect.value;
            if (purchaseAmount <= 0 || vatRate < 0 || cashbackRate < 0) { updateResults(0,0,0,0,currency); return; }

            const netPrice = purchaseAmount / (1 + vatRate/100);

            // base cashback from net price
            const baseCashback = netPrice * (cashbackRate/100);

            // apply optional cap (cap applies to the cashback amount before USD background reduction)
            let cashbackCapped = baseCashback;
            if (capToggle && capToggle.checked) {
                const capVal = parseFloat(capAmount.value);
                if (!isNaN(capVal) && capVal >= 0) {
                    cashbackCapped = Math.min(baseCashback, capVal);
                }
            }

            // effective price WITHOUT USD-background reduction
            const effectivePrice = purchaseAmount - cashbackCapped;

            // USD background reduction (5%) — show separate effective price if active
            const usdBgActive = usdBgToggle && usdBgToggle.checked;
            let cashbackAfterUsdBg = null;
            let effectiveAfterUsdBg = null;
            if (usdBgActive) {
                cashbackAfterUsdBg = cashbackCapped * 0.95; // reduce cashback by 5%
                effectiveAfterUsdBg = purchaseAmount - cashbackAfterUsdBg;
            }

            const savingsPercent = purchaseAmount > 0 ? (cashbackCapped / purchaseAmount) * 100 : 0;
            updateResults(netPrice, cashbackCapped, effectivePrice, savingsPercent, currency, usdBgActive ? effectiveAfterUsdBg : null);
        }

        function updateResults(netPrice, cashback, effectivePrice, savings, currency, effectiveAfterUsdBg = null) {
            resultNetPrice.textContent = formatCurrency(netPrice, currency);
            resultCashback.textContent = formatCurrency(cashback, currency);
            resultEffectivePrice.textContent = formatCurrency(effectivePrice, currency);

            if (typeof effectiveAfterUsdBg === 'number') {
                resultEffectiveAfter.textContent = formatCurrency(effectiveAfterUsdBg, currency);
                if (conversionRow) conversionRow.style.display = '';
            } else {
                if (conversionRow) conversionRow.style.display = 'none';
            }
        }

        function formatCurrency(amount, currency) {
            const symbol = CURRENCY_SYMBOLS[currency] || '';
            const formatted = (isNaN(amount) ? 0 : amount).toFixed(2);
            return `${formatted} ${symbol}`;
        }
    </script>
</body>
</html>
